
<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<title>锤子，注册</title>
		<meta http-equiv="X-UA-Compatible" content="IE=edge">
		
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		
		<link rel="stylesheet" href="css/bootstrap.min.css" />
		<link rel="stylesheet" href="css/register.css" />
		
		<link rel="stylesheet" href="css/common.css" />
		
	</head>
	<body>
		<div id="cont">
			<div id="tltle">
				<h2>注册 Smartisan ID</h2>
				<p><input type="text" id="phone"placeholder="请输入用户名" /><span class="success">正确</span><span class="error">用户名已存在</span></p>
				<p><input type="password" id="password" placeholder="请输入6－20位字符密码" /></p>
				<p><input type="password" id="re-password" placeholder="重复密码" /></p>
				<button id="register">注册</button>
				<p id="login"><a href="login.html">如果您已拥有 Smartisan ID，则可在此登录</a></p>
			</div>
		</div>
		<script src="js/jquery-3.2.1.js" type="text/javascript" charset="utf-8"></script>
		<script type="text/javascript" src="js/bootstrap.min.js" ></script>
		<script type="text/javascript" src="js/register.js" ></script>
		<script type="text/javascript">
			
			
//			用ajax判断用户名是否重复
//			如果不重复提示用户可以使用
//			重复提示用户用户名重复
			
			//用户名验证是否重复
			var a=0
			var d= 0
			var b = 0
			$("#phone").keyup(function(){
				
				var username = $('#phone').val();
				
				console.log(username);
				
				$.ajax({
					"url":"http://h6.duchengjiu.top/shop/api_user.php",
					"type":"POST",
					"dataType": "json",
					"data": {
						"status": "check",
						"username": username
					},
					"success": function(response){
						console.log(response);
						
						if(response.code === 0){
							//成功后
							$(".success").show();
							$(".error").hide();
						}else if(response.code === 2001){
							//失败后
							$(".error").show();
							$(".success").hide();
						}
						
						
					}
				
				});
				
			})
			
			$("#phone").blur(function(){
				
				var username = $('#phone').val();
				
				console.log(username);
				
				$.ajax({
					"url":"http://h6.duchengjiu.top/shop/api_user.php",
					"type":"POST",
					"dataType": "json",
					"data": {
						"status": "check",
						"username": username
					},
					"success": function(response){
						console.log(response);
						
						if(response.code === 0){
							//成功后
							a=1
						}else if(response.code === 2001){
							//失败后
							a=0
						}
						
						
					}
				
				});
				
			})
			
			
			$("#password").blur(function(){
				var password = $('#password').val();
				if(password.length < 6 || password.length > 20){
					b=0
					alert("密码长度应该是6-20位之内！");
					return;
				}else{
					b=1
				}
				
			})
			
//			注册验证
			$("#register").click(function(){
				if(a==0){
					alert("用户名不对")
					return
				}else if(b==0){
					alert("密码长度不够")
					return
					
				}else if(d==0){
					alert("两次密码不一样")
					return
					
				}else{
					var username = $('#phone').val();
					var password = $('#password').val();
					
	
					$.ajax({
						"url":"http://h6.duchengjiu.top/shop/api_user.php",
						"type":"POST",
						"dataType": "json",
						"data": {
							"status":"register",
							"username":username,
							"password": password
						},
						"success": function(response){
							console.log(response);
							
							if(response.code === 0){
								alert(response.message);
								window.location.href = "login.html";
							}
							 
						}
					});
				}
				
				
			})
			
//			$("#re-password").focus(function(){
//				if($(this).val() == "确认密码"){
//					$(this).val("")
//					$(this).attr("type","password")
//				}
//			})
			
			
			
			$("#re-password").blur(function(){
				
				if($(this).val() == $("#password").val() ){
					d=1
				}else{
					
					d=0
				}
				
			})
			
		</script>
	</body>
</html>
